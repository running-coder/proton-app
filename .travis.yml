matrix:
  include:
    - os: osx
      osx_image: xcode10.2
      language: node_js
      node_js: "10"
      env:
        - ELECTRON_CACHE=$HOME/.cache/electron
        - ELECTRON_BUILDER_CACHE=$HOME/.cache/electron-builder

    - os: linux
      services: docker
      language: generic

cache:
  directories:
    - node_modules
    - $HOME/.cache/electron
    - $HOME/.cache/electron-builder

script:
  - |
    if [ "$TRAVIS_OS_NAME" == "linux" ]; then
      docker run --rm \
        --env-file <(env | grep -iE 'DEBUG|NODE_|ELECTRON_|YARN_|NPM_|CI|CIRCLE|TRAVIS|APPVEYOR_|CSC_|_TOKEN|_KEY|AWS_|STRIP|BUILD_')> \
        -v ${PWD}:/project \
        -v ~/.cache/electron:/root/.cache/electron \
        -v ~/.cache/electron-builder:/root/.cache/electron-builder \
        electronuserland/builder:wine \
        /bin/bash -c "yarn --link-duplicates --pure-lockfile && yarn release --linux --win"
    else
      yarn release
    fi
before_cache:
  - rm -rf $HOME/.cache/electron-builder/wine

branches:
  only:
    - master

after_success:
  - |
    $(npm bin)/set-up-ssh --key "encrypted_16f789e03726_key" \
                          --iv "encrypted_16f789e03726_iv" \
                          --path-encrypted-key ".travis/github_deploy_key.enc"
env:
  global:
    - secure: "HzUWIaqYSQ2DItekvMkjuQQ3KRDBBfaVRF+gvN8wtiMlOpRIg6nbdExd2gVJf1kurCuttSWvJRB2fonXughMfhoiofvNG1c2+lt3P2RHTGqAnXAv27+cVFj10E34jhNJlBFOuzDjqIf0arIEu1zk8Owk8cARgT7QIqmIFYYx+PnTgn+4YZOTk1FbJ0rYZeEtXywncS5tWY2N88patDBgQOTcF4GixPQhpUYrlF1yj9orTShU1fw6m7Gf4cN0gihjj0Gv0HXYaNQhxHCYa3usHKlvtB0/8qkyT4MQX98h5nMGBqMazcUnyF36nreIsgWcd/yGXDPJLNO9XEu3WZ2frB5hkqoQaV9pYW1xi+B9/UPi53DZ4yEGR/mTIJFVwov+N3RbZk0P7egNNC+ZXUziggDqG5s53c7a26foS95NVRfRHxlqUy1Mel/EjfTAU6FxygDm6em8OCi/i9UWTB9OPdflx+zwAbbN97MjkZxha29lQzZ66L6P6jgzV6VmkTTS7qP6LrWtwkYwZ4X8C0IV49c7c1cFtgZIaKhfw/+y00yvtW+ac2qGMqh53ZQbtlrHKHSIMtJcL/LZvE1i1DNBLWcorJ1H22wrlaMazqIjx6Dyz2zbSCtINWeZqGADX+DlM6D2f5kZLGEflzJePwBJQuSiCYeZKQQfaIeCXjaFaSk="

deploy:
  provider: releases
  api_key:
    secure: encrypted_16f789e03726_key
  file: "dist/hi-0.0.1.dmg"
  skip_cleanup: true
  draft: true
